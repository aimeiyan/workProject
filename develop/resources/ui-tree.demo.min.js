/*   
 Template Name: Color Admin - Responsive Admin Dashboard Template build with Twitter Bootstrap 3.3.5
 Version: 1.9.0
 Author: Sean Ngu
 Website: http://www.seantheme.com/color-admin-v1.9/admin/
 */

var handleJstreeAjax = function () {

    var to = false;
    $('.hr-tree-select').keyup(function () {
        if (to) {
            clearTimeout(to);
        }
        to = setTimeout(function () {
            var v = $('.hr-tree-select').val();
            $('#jstree-ajax').jstree(true).search(v);
        }, 250);
    });


    $(document).on("click", ".hr-tree-select,.hr-tree-select-down", function () {
        $("body").append('<div id="jstree-ajax" style="display: none;"></div>');
        $("#jstree-ajax").jstree({
            core: {
                themes: {responsive: !1}, check_callback: !0,
                data: {
                    "url": "root.json",
                    "data": function (node) {
                        console.log(node);
                        return {"id": node.id};
                    }
                }
            },
            types: {
                root: {icon: "fa fa-folder text-warning fa-lg"},
                file: {icon: "fa fa-file text-warning fa-lg"}
            },
            //plugins: ["massload","state", "types","search","checkbox","wholerow",]
            plugins: ["massload", "state", "types", "search"]
        });

        //return;
        $('#jstree-ajax').on("select_node.jstree", function (e, data) {
            var current_value = data.instance.get_node(data.selected[0]).text;
            var current_id = data.instance.get_node(data.selected[0]).id;
            $(".hr-tree-select").val(current_value);
            //console.log(current_value,current_id);

        });

        //$('#jstree-ajax').bind("hover_node.jstree", function(e, data){
        //    //var nodeId = jQuery.data(data.rslt.obj[0], "jstree").id;
        //    console.log(data.node.id);
        //    console.log('-----');
        //});

        //$("#jstree-ajax").jstree("get_checked", function (e, data) {
        //    console.log(this.data);
        //    //console.log(this.id);
        //})

        if ($("#jstree-ajax").is(":visible")) {
            hideMenu();

        } else {
            showMenu();
        }
    })

    function showMenu() {
        var cityObj = $(".hr-tree-select");
        var cityOffset = cityObj.offset();
        $("#jstree-ajax").css({
            position: 'absolute',
            left: cityOffset.left + "px",
            top: cityOffset.top + cityObj.outerHeight() + "px",
            width: cityObj.outerWidth(),
            maxHeight: '300px',
            minHeight: '160px',
            overflowY: 'scroll',
            border: '1px solid #aaa',
            backgroundColor: '#fff',
            padding: '10px 5px',
            zIndex: '2000'
        }).slideDown("fast");

        $("body").bind("mousedown", onBodyDown);
    }

    function hideMenu() {
        $("#jstree-ajax").slideUp("fast");
        $("body").unbind("mousedown", onBodyDown);
        var url = search_input_value();

        table.api().ajax.url(url).load();
    }

    function onBodyDown(event) {
        if (!(event.target.id == "jstree-ajax" || $(event.target).parents("#jstree-ajax").length > 0)) {
            hideMenu();
        }
    }
}, TreeView = function () {
    "use strict";
    return {
        init: function () {
            handleJstreeAjax()
        }
    }
}();