/*   
 Template Name: Color Admin - Responsive Admin Dashboard Template build with Twitter Bootstrap 3.3.5
 Version: 1.9.0
 Author: Sean Ngu
 Website: http://www.seantheme.com/color-admin-v1.9/admin/
 */

var handleJstreeAjax = function () {

    var to = false;
    $('.hr-tree-select').keyup(function () {
        if(to) { clearTimeout(to); }
        to = setTimeout(function () {
            var v = $('.hr-tree-select').val();
            $('#jstree-ajax').jstree(true).search(v);
        }, 250);
    });

    $(".hr-tree-select,.hr-tree-select-down").click(function () {
     $("body").append('<div id="jstree-ajax" style="display: none;"></div>');
        $("#jstree-ajax").jstree({
            core: {
                themes: {responsive: !1}, check_callback: !0,
                data: {
                    "url": "../tree/data/root.json",
                    "data": function (node) {
                        //return{
                        //    "id" : n.attr ? n.attr("id") : 0
                        //}
                        return {"id": node.id};
                    }
                }
            },
            types: {
                root: {icon: "fa fa-folder text-warning fa-lg"},
                file: {icon: "fa fa-file text-warning fa-lg"}
            },
            plugins: ["themes","massload","state", "types","json_data","ui","search","checkbox","wholerow",]
            //plugins: ["massload","state", "types","search"]
        });

        //return;
        $('#jstree-ajax').on("changed.jstree", function (e, data) {
            var current_value = data.instance.get_node(data.selected[0]).text;
            $(".hr-tree-select").val(current_value);
        });

        //$("#jstree-ajax").jstree("get_checked", function (e, data) {
        //    console.log(this.data);
        //    //console.log(this.id);
        //})

        if ($("#jstree-ajax").is(":visible")) {
            hideMenu()
        } else {
            showMenu();
        }
    })

    function showMenu() {
        var cityObj = $(".hr-tree-select");
        var cityOffset = cityObj.offset();
        $("#jstree-ajax").css({
            position: 'absolute',
            left: cityOffset.left + "px",
            top: cityOffset.top + cityObj.outerHeight() + "px",
            width: cityObj.outerWidth(),
            maxHeight: '300px',
            overflowY: 'scroll',
            border: '1px solid #aaa',
            backgroundColor: '#fff',
            padding: '10px 5px',
            zIndex: '2000'
        }).slideDown("fast");

        $("body").bind("mousedown", onBodyDown);
    }

    function hideMenu() {
        $("#jstree-ajax").slideUp("fast");
        $("body").unbind("mousedown", onBodyDown);
    }

    function onBodyDown(event) {
        if (!(event.target.id == "jstree-ajax" || $(event.target).parents("#jstree-ajax").length > 0)) {
            hideMenu();
        }
    }
}, TreeView = function () {
    "use strict";
    return {
        init: function () {
            handleJstreeAjax()
        }
    }
}();